---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={entry.data.title}>
  <article class="max-w-4xl mx-auto px-4 py-20">
    
    {entry.data.image && (
      <div class="mb-12 rounded-[40px] overflow-hidden shadow-2xl aspect-video">
        <img src={entry.data.image} alt={entry.data.title} class="w-full h-full object-cover" />
      </div>
    )}

    <header class="mb-12">
      <h1 class="text-4xl md:text-5xl font-bold text-slate-900 mb-6">{entry.data.title}</h1>
      <p class="text-xl text-slate-500 italic">{entry.data.description}</p>
    </header>

    <div class="prose prose-lg prose-slate max-w-none">
      <Content />
    </div>

    {entry.data.downloadFile && (
      <div class="mt-16 bg-slate-900 p-10 rounded-[40px] text-white flex flex-col md:flex-row items-center justify-between gap-6">
        <div>
          <h3 class="text-2xl font-bold">Get the Full Shopping List</h3>
          <p class="text-slate-300">Download the PDF version of this guide to keep on your phone.</p>
        </div>
        <a href={entry.data.downloadFile} download class="bg-white text-slate-900 px-10 py-4 rounded-full font-bold hover:bg-slate-200 transition-all">
          Download PDF
        </a>
      </div>
    )}

    {entry.data.recommendedProducts && (
      <section class="mt-20 border-t border-slate-100 pt-16">
        <h2 class="text-3xl font-bold text-slate-900 mb-10">Vetted Gear in this Article</h2>
        <div class="grid md:grid-cols-2 gap-8">
          {entry.data.recommendedProducts.map((product) => (
            <div class="bg-slate-50 p-8 rounded-[30px] border border-slate-100 flex flex-col justify-between">
              <div>
                <h4 class="font-bold text-xl text-slate-900 mb-2">{product.name}</h4>
                <div class="text-2xl font-black text-slate-900 mb-4">{product.price}</div>
              </div>
              <a href={product.link} target="_blank" class="block w-full text-center bg-slate-900 text-white py-4 rounded-2xl font-bold hover:bg-slate-700 transition-colors">
                Check on {product.retailer} â†’
              </a>
            </div>
          ))}
        </div>
      </section>
    )}
    
  </article>
</Layout>